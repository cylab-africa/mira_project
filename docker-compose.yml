version: '2'
services:
  upz_packets_routes_Africa:
    build: ./upz_packets_routes_Africa
    #network_mode: "host"
    # No ports need to be exposed for the client
    restart: always
    volumes:
      - 'pr_data:/reports' #packets_routes_data
  upz_mesh_routes:
    build: ./upz_mesh_routes
    #network_mode: "host"
    # No ports need to be exposed for the client
    restart: always
    volumes:
      - 'mr_data:/reports' #mesh_routes_data
  upz_web_perfomance_measurements:
    build: ./upz_web_perfomance_measurements
    restart: always
    volumes:
      - 'wm_data:/reports' #web_measurement_data
  upz_iperf3-server:
    build: ./upz_iperf3-server
    network_mode: "host"
    ports:
      - "5201:5201" # Default iPerf3 server port
    restart: always
  upz_iperf3-client:
    build: ./upz_iperf3-client
    volumes:
      - 'iprf_data:/reports' # Iperf Data 
    restart: always
  upz_network_usage_monitor:
    build: ./upz_network_usage_monitor
    environment:
      - MONITOR_CONTAINERS=upz_packets_routes_Africa,upz_mesh_routes,upz_web_perfomance_measurements,upz_iperf3-server,upz_iperf3-client
    restart: always
    cap_add:
      - NET_ADMIN
    privileged: true

volumes:
  pr_data:
  mr_data:
  wm_data:
  iprf_data:
  nu_data: